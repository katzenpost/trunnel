package gen

import (
	"bytes"
	"fmt"

	"golang.org/x/tools/imports"
)

type printer struct {
	buf bytes.Buffer
}

func (p *printer) output() []byte {
	return p.buf.Bytes()
}

func (p *printer) imported() ([]byte, error) {
	return imports.Process("", p.output(), nil)
}

func (p *printer) header(pkg string) {
	p.printf("// Code generated by trunnel. DO NOT EDIT.\n\n")
	p.printf("package %s\n\n", pkg)
}

func (p *printer) printf(format string, a ...interface{}) {
	if _, err := fmt.Fprintf(&p.buf, format, a...); err != nil {
		panic(err) // printing to a bytes.Buffer should never fail
	}
}
